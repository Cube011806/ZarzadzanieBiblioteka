@using Microsoft.AspNetCore.Identity
@model ICollection<Ksiazka>
@inject UserManager<Uzytkownik> UserManager
<div class="text-center">
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show text-center" role="alert">
            <strong>@TempData["ErrorMessage"]</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show text-center" role="alert">
            <strong>@TempData["SuccessMessage"]</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (User.Identity.IsAuthenticated)
    {
        if (Model.Count != 0)
        {
            foreach (var ksiazka in Model)
            {
                <div>
                    <img src="@ksiazka.Okladka" width="20%" />
                    @ksiazka.Tytul
                    
                    @ksiazka.Autor.Imie
                    @ksiazka.Autor.Nazwisko 
                    @ksiazka.Wydanie
                    @ksiazka.DataWydania
                    <a asp-action="Delete" asp-route-id="@ksiazka.Id" class="btn btn-primary btn-lg">
                        Usuń książkę
                    </a>
                    <a asp-action="Edit" asp-route-id="@ksiazka.Id" class="btn btn-primary btn-lg">
                        Edytuj książkę
                    </a>
                    @if(ksiazka.Opinie.Count == 0)
                    {
                        <a asp-action="AddReview" asp-route-idksiazka="@ksiazka.Id" class="btn btn-secondary btn-lg">
                            Dodaj opinię
                        </a>
                    }
                    @if(ksiazka.Opinie.Count == 0)
                    {
                        <p>Brak opinii</p>
                    }
                    else
                    {
                        <p>Opinie: </p>
                        foreach(var opinia in ksiazka.Opinie)
                        {
                            @opinia.Ocena
                            @opinia.Komentarz
                            <a asp-action="EditReview" asp-route-id="@opinia.Id" asp-route-idksiazka="@ksiazka.Id" class="btn btn-secondary btn-lg">
                                Zmień opinię
                            </a>
                            <a asp-action="DeleteReview" asp-route-id="@opinia.Id" class="btn btn-secondary btn-lg">
                                Usuń opinię
                            </a>
                        }
                    }
                </div>
            }
        }
        else
        {
            <h2>Brak książek w katalogu</h2>
        }
        <a asp-action="Add" class="btn btn-primary btn-lg">
            Dodaj Książkę
        </a>

    }
    else
    {
        <h1 class="display-4">Brak dostępu!</h1>
    }
</div>